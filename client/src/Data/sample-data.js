
import { v4 as uuidv4 } from "uuid";

let sampleLemmata = [
  {
    "lemmaId": "676905a6-25ea-409d-9a83-eebfa8d27de4",
    "published": true,
    "translation": "furrow",
    "language": "akkadian",
    "original": "ABSIN",
    "transliteration": "šer'u",
    "partOfSpeech": "noun",
    "meanings": [
      {"id": 1, "value": "Virgo (zodiacal sign)"},
      {"id": 2, "value": "Furrow (constellation)"}
    ],
    "variants": [
      {
        "id": 1,
        "original": "mulABSIN",
        "transliteration": "šer'u"
      },
      {
        "id": 2,
        "original": "mul2ABSIN",
        "transliteration": "šer'u"
      },
      {
        "id": 3,
        "original": "ABSIN0 (KI)",
        "transliteration": "šer'u"
      },
      {
        "id": 4,
        "original": "mulAB.SIN2",
        "transliteration": "šer'u"
      }
    ],
    "crosslinks": [
      {
        "id": 1,
        "link": "ac711882-e49e-48f8-9969-e794206a3626"
      }
    ],
    "quotations": [
      {
        "id": 1,
        "original": "mul2UR.A mul2ABSIN mul2GIR2.TAB PA.BIL MAŠ2 u KUN.ME PAP 6 KI.MEŠ ša2 sin ina ŠA3-ši-na TUR3 NIGIN2-ma ana 8-i u4-mu IM ŠAR2-tu u ZI.A",
        "transliteration": "",
        "translation": "The Lion (Leo), the Furrow (Virgo), the Scorpion (Scorpio), Pabilsag (Sagittarius), the Goat-Fish (Capricorn) and the Tails (Pisces): in total 6 areas where Sin, (if) he is surrounded by a halo within them, then for 8 days wind and ...",
        "source": "AO 6455 (TU 11) rev. 29",
        "genre": "astrological and astronomical procedure text",
        "provenance": "Uruk",
        "date": "ca. 200 BCE",
        "publication": "Brack-Bernsen & Hunger 2002 (see BibMAS)",
        "link": ""
      },
      {
        "id": 2,
        "original": "TA 13 ABSIN0 EN 27 zib ITI ana ITI 2.⸢6⸣.15.42 TAB u LA2",
        "transliteration": "",
        "translation": "From 13 Furrow (Virgo) until 27 Tails (Pisces) month by month 2,6;15,42 add and subtract.",
        "source": "BM 55530 (Ossendrijver 2012 No. 60) obv. 8'",
        "genre": "mathematical astronomy procedure text",
        "provenance": "Babylon",
        "date": "",
        "publication": "Ossendrijver 2012 (see BibMAS)",
        "link": ""
      },
      {
        "id": 3,
        "original": "DIS mulGU4.AN.NA mulAB.SIN2 u mul[SUḪUR.MAŠ] 3 KI.MEŠ a-n[a kur]⸢NIM?⸣. [MAki]",
        "transliteration": "",
        "translation": "The Bull of Heaven (Taurus), the Furrow (Virgo), and the Goat-Fish (Capricorn): 3 areas for [Elam].",
        "source": "BM 47494 rev. 17-18",
        "genre": "astrological compendium",
        "provenance": "Babylon?",
        "date": "ca. 3xx BCE",
        "publication": "Hunger 2004 (see BibMAS)",
        "link": ""
      }
    ],
    "externalLinks": []
  },
  {
    "lemmaId": "fa9850a3-288c-4af2-8933-607a88ee4962",
    "published": true,
    "translation": "Sheep",
    "language": "egyptian",
    "original": "𓃝",
    "transliteration": "ỉsw",
    "partOfSpeech": "noun",
    "meanings": [
      {"id": 1, "value": "Aries"},
      {"id": 2, "value": "Ram"}, 
      {"id": 3, "value": "Sheep"}
    ],
    "variants": [
      {
        "id": 1,
        "original": "𓊃𓂋𓄛",
        "transliteration": "sr"
      },
      {
        "id": 2,
        "original": "𓁶",
        "transliteration": "tpy"
      }
    ],
    "crosslinks": [
      {
        "id": 1,
        "link": "ac711882-e49e-48f8-9969-e794206a3626"
      }
    ],
    "quotations": [
      {
        "id": 1,
        "original": "",
        "transliteration": "ỉbd 2 pr.t pꜣ ỉsw",
        "translation": "Month 2 of Peret (Mecheir): Aries",
        "source": "O.Strasb. 521.7",
        "genre": "Astrological/Astronomical list",
        "provenance": "Egypt",
        "date": "Roman",
        "publication": "O. Neugebauer, “Demotic Horoscopes”, JAOS 63 (1943), 121–121 (115–127).",
        "link": ""
      },
      {
        "id": 2,
        "original": "",
        "transliteration": "pꜣ rꜥ-ḫꜥ tꜣ ỉḫy(.t) | rꜥ-ḥtp pꜣ ỉsw",
        "translation": "Ascendant: Libra; Descendant: Aries",
        "source": "O.Neugebauer 3.4–5",
        "genre": "Horoscope",
        "provenance": "Thebes",
        "date": "after AD 18",
        "publication": "O. Neugebauer, “Demotic Horoscopes”, JAOS 63 (1943), 117–119 (115–127).",
        "link": ""
      }
    ],
    "externalLinks": [
      {
        "id": 1,
        "url": "http://aaew2.bbaw.de/tla/servlet/GetWcnDetails?wn=00700&db=1",
        "display": "TLA: ỉsw"
      },
      {
        "id": 2,
        "url": "https://www.dwl.aegyptologie.lmu.de/suche.php?nummer=00700",
        "display": "DWL: ỉsw"
      }
    ]
  },
  {
    "lemmaId": "ac711882-e49e-48f8-9969-e794206a3626",
    "published": true,
    "translation": "ram",
    "language": "greek",
    "original": "κριός",
    "transliteration": "krios",
    "partOfSpeech": "noun",
    "meanings": [
      {"id": 1, "value": "Aries (zodiac sign)"}, 
      {"id": 2, "value": "Aries (constellation)"}
    ],
    "variants": [],
    "crosslinks": [
      {
        "id": 1,
        "link": "fa9850a3-288c-4af2-8933-607a88ee4962"
      },
      {
        "id": 2,
        "link": "676905a6-25ea-409d-9a83-eebfa8d27de4"
      }
    ],
    "quotations": [
      {
        "id": 1,
        "original": "ζωϊδίων δέ ἑ κύκλον ἐπίκλησιν καλέουσιν  τῷ ἔνι Καρκίνος ἐστί, Λέων ἐπὶ τῷ, μετὰ δ’ αὐτὸν Παρθένος  αἱ δ’ ἐπί οἱ Χηλαὶ καὶ Σκορπίος αὐτὸς Τοξευτής τε καὶ Αἰγόκερως, ἐπὶ δ’ Αἰγοκερῆϊ Ὑδροχόος  δύο δ’ αὐτῷ ἔπ’ Ἰχθύες ἀστερόεντες, τοὺς δὲ μέτα Κριός, Ταῦρος δ’ ἐπὶ τῷ Δίδυμοί τε. ἐν τοῖς ἠέλιος φέρεται δυοκαίδεκα πᾶσιν πάντ’ ἐνιαυτὸν ἄγων, καί οἱ περὶ τοῦτον ἰόντι κύκλον ἀέξονται πᾶσαι ἐπικάρπιοι ὧραι.",
        "transliteration": "",
        "translation": "They call it (sc. the ecliptic) by the name 'Circle of the figurines' (zōdiōn kyklos, i.e. the zodiac): in it is Cancer, after that there is Leo, after that is Virgo, and after that, the Claws and Scorpio itself, Sagittarius and Capricorn, and after Capricorn, Aquarius, and after it, the two stary Fish (i.e. Pisces), and after them Aries, and after it Taurus and Gemini. In all twelve of them the Sun moves along as it passes each year, and as it goes around this circle, all the seasons wax fruitful.",
        "source": "Aratus 543–552",
        "genre": "didactic poem on astronomy",
        "provenance": "Pella",
        "date": "ca. 276–274 BCE",
        "publication": "",
        "link": ""
      },
      {
        "id": 2,
        "original": "τῷ δὲ μηνὶ τῷ Ξανθικῷ, ὃς Νισὰν παρ’ ἡμῖν καλεῖται καὶ τοῦ ἔτους ἐστὶν ἀρχή, τεσσαρεσκαιδεκάτῃ κατὰ σελήνην ἐν κριῷ τοῦ ἡλίου καθεστῶτος  τούτῳ γὰρ τῷ μηνὶ τῆς ὑπ’ Αἰγυπτίους δουλείας ἠλευθερώθημεν",
        "transliteration": "",
        "translation": "(The sacrifice of pascha is celebrated) in the month of Xanthikos, which among us (sc. Jews) is called Nisan and is the beginning of the year, on the fourteenth (of the month) according to the Moon, when the Sun is in Aries—for in this month we were liberated from servitude to Egyptians",
        "source": "Josephus, Antiquities of the Jews 3.10.5 (248)",
        "genre": "history",
        "provenance": "Rome",
        "date": "93/94 CE",
        "publication": "",
        "link": ""
      },
      {
        "id": 3,
        "original": "Κριός ἐστιν οἶκος Ἄρεως, ζῴδιον ἀρρενικόν, τροπικόν, χερσαῖον, ἡγεμονικόν, πυρῶδες, ἐλεύθερον, ἀνωφερές, ἡμίφωνον, ἀγαθόν, εὐμετάβολον, διοικητικόν, δημόσιον, πολιτικόν, ὀλιγόγονον, λατρῶδες, κόσμου μεσουράνημα καὶ δόξης αἴτιον, δίχρωμον ἐπεὶ ὁ Ἥλιος καὶ ἡ Σελήνη ποιοῦσιν ἀλφούς, λειχῆνας  ἔστι δὲ καὶ ἀσύνδετον, ἐκλειπτικόν",
        "transliteration": "",
        "translation": "Aries is a house of Ares, a masculine zodiac-sign, tropic, of dry-land, hegemonic, of fire, of free men, ascending, semi-voiced, good, variable, controlling, of the (common) people, political, of low fertility, servile, the midheaven of the cosmos and a source of glory, two-colored when Sun and Moon produce spots (and) cankers; it is also non-conjunctive, ecliptic",
        "source": "Vettius Valens 1.2.1",
        "genre": "astrological treatise",
        "provenance": "Antioch",
        "date": "ca. 152–162 CE",
        "publication": "",
        "link": ""
      }
    ],
    "externalLinks": [
      {
        "id": 1,
        "url": "http://stephanus.tlg.uci.edu/Iris/inst/lexica.jsp#qid=174929&ql=KRIO%2FS%2C%20-OU%3D%2C%20O(&q=%CE%BA%CF%81%CE%B9%CF%8C%CF%82%2C%20%E2%80%91%CE%BF%E1%BF%A6%2C%20%E1%BD%81&usr_input=greek",
        "display": "TLG: κριός"
      }
    ]
  }
];


// Load lemmata from localStorage if available, otherwise set it to default sample data
// This is temporary until we get the real database
// -CDC 2022-08-11

let lemmata = null;
lemmata = JSON.parse(localStorage.getItem('lemmata') || null);
if (!lemmata) {
  localStorage.setItem("lemmata", JSON.stringify(sampleLemmata));
  lemmata = sampleLemmata;
}

export function getLemmataList(token) {
  let lemmataList = lemmata.map(lemma => {
    return {
    lemmaId: lemma.lemmaId,
    published: lemma.published,
    translation: lemma.translation,
    original: lemma.original,
    transliteration: lemma.transliteration,
    language: lemma.language,
  }})
  if (!token)
    lemmataList = lemmataList.filter(lemma => lemma.published)
  return lemmataList;
}

export function getLemma(lemmaId) {
  return lemmata.find(lemma => lemma.lemmaId === lemmaId);
}

export function addNewLemma() {
  // Move some of this back into <Sidebar />
  // esp. the creation of the new object and the id
  lemmata = JSON.parse(localStorage.getItem('lemmata') || null);
  if (!lemmata)
    throw new Error('Problem with sample data in localStorage');
  
  let newLemmaId = uuidv4();
  const newLemma = {
    lemmaId: newLemmaId,
    published: false,
    translation: '',
    language: '',
    original: '',
    transliteration: '',
    partOfSpeech: '',
    meanings: [],
    variants: [],
    crosslinks: [],
    quotations: [],
    
    changed: true,
  };
  
  lemmata.push(newLemma);
  localStorage.setItem("lemmata", JSON.stringify(lemmata));
  
  return newLemmaId;
}

export function saveLemmaToDB(newLemma) {
  const newLemmata = lemmata.map(lemma => {
      if (lemma.lemmaId === newLemma.lemmaId) {
        return newLemma;
      }
      return lemma;
    });
  lemmata = newLemmata;
  localStorage.setItem("lemmata", JSON.stringify(newLemmata));
}

export function deleteLemmaFromDB(lemmaId) {
  
  // Don't delete the very last lemma or everything fubars
  if (lemmata.length <= 1)
    return;
  
  const newLemmata = lemmata.filter(lemma => {
    return (lemma.lemmaId !== lemmaId);
  });
  lemmata = newLemmata;
  
  // REPLACE WITH A PROPER LAMBDA FUNCTION CALL
  localStorage.setItem("lemmata", JSON.stringify(newLemmata));
};
